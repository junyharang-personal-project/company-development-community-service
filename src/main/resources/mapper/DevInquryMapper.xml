<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.devcommunity.junyharang.mapper.support.DevInquryMapper">

    <!-- Q&A 게시글 등록 -->
<!--    <insert id="devInquryInsert" parameterType="com.devcommunity.junyharang.model.vo.support.DevInquryVO">-->
<!--        <![CDATA[-->
<!--        INSERT INTO tb_com_inqry (-->
<!--            INQRY_SJ,-->
<!--            INQRY_CN,-->
<!--            FILE_SN,-->
<!--            CREAT_DT,-->
<!--            CRTR_SN,-->
<!--            UPDT_DT,-->
<!--            UPDUSR_SN,-->
<!--            ANSWER_AT,-->
<!--            SECRET_AT,-->
<!--            INQRY_USER_SN-->
<!--        ) VALUES (-->
<!--         #{inqrysj},-->
<!--         #{inqryCn}-->
<!--         #{fileSn},-->
<!--         NOW(),-->
<!--         #{crtSn},-->
<!--         NOW(),-->
<!--         #{updusrSn},-->
<!--         'N',-->
<!--         #{secretAt},-->
<!--         #{inqryUserSn}-->
<!--        )-->
<!--        ]]>-->
<!--	</insert>-->

    <!-- Q&A 목록 조회 -->
    <select id="devInquryList" parameterType="com.devcommunity.junyharang.model.vo.support.DevInquryVO" resultType="com.devcommunity.junyharang.model.vo.support.DevInquryVO">
        select row_number() over(order by i.INQRY_SN asc) as INQRY_INDEX , i.INQRY_SN, i.INQRY_USER_SN , i.FILE_SN , i.INQRY_CN , i.INQRY_SJ , i.SECRET_AT , i.ANSWER_AT , i.ANSWER_CN , i.ANSWER_USER_SN , i.ANSWER_DT , i.CREAT_DT , i.UPDT_DT , i.UPDUSR_SN, u.USER_ID
        from tb_com_inqry i inner join tb_user u
        on i.INQRY_USER_SN = u.user_sn
        where 1=1
        <if test=' srchType neq null and srchType neq "" '>
            <choose>
                <when test="srchType eq '1'.toString()">
                    and INQRY_SJ like CONCAT('%', #{srchWord}, '%')
                </when>
                <when test="srchType eq '2'.toString()">
                    and INQRY_CN like CONCAT('%', #{srchWord}, '%')
                </when>
                <when test="srchType eq '3'.toString()">
                    and u.USER_ID like CONCAT('%', #{srchWord}, '%')
                </when>
            </choose>
        </if>
        order by INQRY_SN desc
        <if test=' pageStart neq null and perPageNum neq null '>
            LIMIT #{pageStart}, #{perPageNum}
        </if>
    </select>



<!--    &lt;!&ndash; Q&A 게시글 수정 &ndash;&gt;-->
<!--    <update id="devInquryUpdate" parameterType="com.devcommunity.junyharang.model.vo.support.DevInquryVO">-->
<!--        UPDATE tb_com_inqry-->
<!--            SET INQRY_SJ    =   #{inqrySj},-->
<!--                INQRY_CN    =   #{inqryCn},-->
<!--                FILE_SN     =   #{fileSn},-->
<!--                UPDT_DT     =   NOW(),-->
<!--                UPDUSR_SN   =   #{updusrSn},-->
<!--                SECRET_AT   =   #{secretAt}-->
<!--            WHERE   INQRY_SN = #{inqrySn}-->
<!--    </update>-->

    <!--  Q&A 조회수 카운트-->
    <select id="devInquryReadhitCount" parameterType="com.devcommunity.junyharang.model.vo.support.DevInquryVO" resultType="Integer">
        select COUNT(*) AS COUNT
        from tb_com_inqry i
        inner join tb_user u
        on i.INQRY_USER_SN = u.user_sn
        where 1=1
        <if test=' srchType neq null and srchType neq "" '>
            <choose>
                <when test="srchType eq '1'.toString()">
                    and INQRY_SJ like CONCAT('%', #{srchWord}, '%')
                </when>
                <when test="srchType eq '2'.toString()">
                    and INQRY_CN like CONCAT('%', #{srchWord}, '%')
                </when>
                <when test="srchType eq '3'.toString()">
                    and u.USER_ID like CONCAT('%', #{srchWord}, '%')
                </when>
            </choose>
        </if>
    </select>

</mapper>